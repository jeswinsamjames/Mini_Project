{% extends 'base.html' %}
{% load static %}
{% block title %}
{{ course.name }} - Course Overview
{% endblock title %}
{% block body %}
<style>
    .bright-bold {
        font-weight: bold;
        font-size:3ch;
        color: #000000;
        padding-top: 50px;
    
    }
</style>
<div class="container-md d-flex p-5 m-2">
    <div class="container-md w-25 mx-auto border-end border-lg border-2 p-3 hidden-lg">
        <p class="leading-7 mb-6">Minimap</p>
        <div class="flex flex-wrap gap-2">
            <!-- Minimap buttons will be dynamically added here -->
        </div>
    </div>
    <main class="p-3 w-100">
        <div class="container-md mx-auto">
            <div class="question border-2 border-bottom pb-4">
                <h2 class="text-lg "></h2>
                <p class="text-md mb-4 bright-bold"></p>
                <div class="flex flex-col space-y-2 mt-4" id="options-container">
                    <!-- Options will be dynamically added here -->
                </div>
            </div>
            <div class="flex flex-wrap flex-col lg:flex-row space-y-2 lg:space-y-0 lg:items-center lg:space-x-2">
                <button class="btn btn-primary h-10 px-4 py-2 previous-question">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="m15 18-6-6 6-6"></path>
                    </svg>
                    Previous Question
                </button>
                <button class="btn btn-primary h-10 px-4 py-2 next-question">
                    Next Question
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="m9 18 6-6-6-6"></path>
                    </svg>
                </button>
                <button class="btn btn-primary h-10 px-4 py-2" id="submit-quiz">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                        <polyline points="17 21 17 13 7 13 7 21"></polyline>
                        <polyline points="7 3 7 8 15 8"></polyline>
                    </svg>
                    Submit
                </button>
                
            </div>
        </div>
    </main>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const data = JSON.parse('{{ questions_json|escapejs }}');
        let questions = data.questions;
        console.log(questions);

        let currentQuestionIndex = 0;
        let chancesRemaining = 2; // Variable to track remaining chances for each question

        const optionsContainer = document.getElementById('options-container');
        const submitButton = document.getElementById('submit-quiz');
        const saveButton = document.getElementById('save-quiz');
        const nextButton = document.querySelector('.btn-primary.next-question');
        const previousButton = document.querySelector('.btn-primary.previous-question');

        function displayQuestion() {
            const currentQuestion = questions[currentQuestionIndex];
            if (currentQuestion) {
                // Reset chances remaining for each question
                chancesRemaining = 2;

                // Display question title
                document.querySelector('.question h2').textContent = `Question ${currentQuestionIndex + 1}`;
                // Display question text
                document.querySelector('.question .text-md').textContent = currentQuestion.title;
                // Clear existing options
                optionsContainer.innerHTML = '';
                // Display options
                currentQuestion.options.forEach((option, index) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'flex items-center space-x-2 p-3 rounded border-2';
                    const input = document.createElement('input');
                    input.type = 'radio';
                    input.className = 'form-check-input';
                    input.name = `Option${currentQuestionIndex}`;
                    input.value = option.text;
                    const label = document.createElement('label');
                    label.className = 'text-sm font-medium leading-none';
                    label.textContent = option.text;
                    optionDiv.appendChild(input);
                    optionDiv.appendChild(label);
                    optionsContainer.appendChild(optionDiv);
                });
            }
        }

        function evaluateResponses() {
            // Remove background color from all options
            optionsContainer.querySelectorAll('.flex.items-center.space-x-2.p-3.rounded.border-2').forEach(optionDiv => {
                optionDiv.style.backgroundColor = ''; // Remove background color
            });

            // Loop through all options and check if they are correct
            optionsContainer.querySelectorAll('input[type="radio"]').forEach((input, index) => {
                const optionDiv = input.parentElement;
                const currentQuestion = questions[currentQuestionIndex];
                const isCorrect = currentQuestion.options[index].is_correct;

                // Mark the option with appropriate color based on correctness
                if (input.checked) {
                    optionDiv.style.backgroundColor = isCorrect ? 'lightgreen' : 'lightcoral';
                    // Decrement chances remaining if an option is selected
                    chancesRemaining--;
                }
            });

            // If chances are exhausted, display the correct answer
            if (chancesRemaining === 0) {
                displayCorrectAnswer();
                submitButton.style.display = 'none';
                nextButton.style.display = 'block'; // Reappear next button for the next question
            }
        }

        function nextQuestion() {
            currentQuestionIndex = (currentQuestionIndex + 1) % questions.length;
            displayQuestion();
            submitButton.style.display = 'block'; // Reappear submit button for the next question
        }

        function displayCorrectAnswer() {
            const currentQuestion = questions[currentQuestionIndex];
            const correctOptionIndex = currentQuestion.options.findIndex(option => option.is_correct);

            // Display the correct answer by marking the option with a special class
            const correctOptionDiv = optionsContainer.querySelectorAll('.flex.items-center.space-x-2.p-3.rounded.border-2')[correctOptionIndex];
            correctOptionDiv.classList.add('correct-answer');
        }

        function previousQuestion() {
            currentQuestionIndex = (currentQuestionIndex - 1 + questions.length) % questions.length;
            displayQuestion();
            // submitButton.style.display = 'block'; // Reappear submit button for the previous question
        }

        // Event listeners for the Next and Previous Question buttons
        nextButton.addEventListener('click', nextQuestion);
        previousButton.addEventListener('click', previousQuestion);

        // Initially display the first question
        displayQuestion();

        submitButton.addEventListener('click', () => {
            evaluateResponses();
        });

        saveButton.style.display = 'none'; // Initially hide the save button

        // Event listener for the save button
        saveButton.addEventListener('click', () => {
            // Add your logic to save quiz responses here
        });
    });
</script>






{% endblock body %}
