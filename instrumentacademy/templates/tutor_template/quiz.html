{% extends 'main_app/base.html' %}
{% load static %}
{% block page_title %}{{ page_title }}{% endblock page_title %}
{% block content %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }

        .container-md {
            margin-top: 50px;
        }

        .minimap-container {
            border: 1px solid #ced4da;
            border-radius: 10px;
            padding: 15px;
        }

        #minimapButtons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        #quizForm {
            background-color: #fff;
            border: 1px solid #ced4da;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .options-container {
            border: 1px solid #ced4da;
            border-radius: 10px;
            padding: 15px;
        }

        .options-container input {
            margin-bottom: 10px;
        }

        .action-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
        }

        .action-buttons button {
            width: 32%;
            margin-top: 8px;
        }

        .correct-option .form-control {
            background-color: #bffed3; /* Light green background for correct option */
            border-color: #00cc00;
        }
        .correct-icon {
            color: rgb(0, 197, 0); /* Color of the tick icon */
            margin-right: 5px; /* Adjust spacing */
        }

    </style>
    <div class="container-md">
        <div class="row">
            <div class="col-md-2 mx-auto">
                <div class="minimap-container">
                    <p class="leading-7 mb-4 text-center">Minimap</p>
                    <div id="minimapButtons">
                        <!-- Minimap buttons will be dynamically added here -->
                    </div>
                </div>
            </div>
            <div class="col-md-10 ">
                <form id="quizForm" class="flex flex-col space-y-4 mx-auto">
                    <button id="addQuestionBtn" class="btn btn-primary w-100" type="button">Create new question</button>
                    <div class="form-group">
                        <label class="text-md font-semibold" for="question-title">Question Title</label>
                        <input type="text" class="form-control" id="question-title" name="question-title"
                            placeholder="Question title">
                    </div>
                    <div id="optionsContainer" class="options-container">
                        <!-- Options will be dynamically added here -->
                    </div>
                    <button id="addOptionBtn" class="btn btn-primary" type="button">Add Option</button>
                    <div class="action-buttons">
                        <button id="saveQuestionBtn" class="btn btn-primary" type="button">Save and add new question</button>
                        <button class="btn btn-secondary" type="reset">Reset</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Initial option index
            let optionIndex = 2;

            // Function to add a new option
            function addOption() {
                const optionsContainer = document.getElementById('optionsContainer');
                const newOptionInput = document.createElement('input');
                newOptionInput.className = 'form-control';
                newOptionInput.name = `option-${optionIndex}`;
                newOptionInput.value = `New Option ${optionIndex}`;
                const optionDiv = document.createElement('div');
                optionDiv.className = 'flex flex-col lg:flex-row space-y-2 lg:space-x-2 option-container';
                optionDiv.appendChild(newOptionInput);

                const buttonDiv = document.createElement('div');
                buttonDiv.className = 'flex justify-between flex-1 p-2';

                const removeBtn = document.createElement('button');
                removeBtn.className = 'btn btn-primary';
                removeBtn.type = 'button';
                removeBtn.textContent = 'Remove';
                removeBtn.addEventListener('click', function () {
                    optionsContainer.removeChild(optionDiv);
                });

                const markCorrectBtn = document.createElement('button');
                markCorrectBtn.className = 'btn btn-primary mark-as-correct-btn';
                markCorrectBtn.type = 'button';
                markCorrectBtn.textContent = 'Mark as correct';

                buttonDiv.appendChild(removeBtn);
                buttonDiv.appendChild(markCorrectBtn);
                optionDiv.appendChild(buttonDiv);

                optionsContainer.appendChild(optionDiv);

                optionIndex++;
            }

            // Function to add a new question
            function addQuestion() {
                const minimapButtons = document.getElementById('minimapButtons');
                const newQuestionBtn = document.createElement('button');
                newQuestionBtn.className = 'btn btn-primary h-10 px-4 py-2';
                newQuestionBtn.textContent = minimapButtons.children.length + 1;
                minimapButtons.appendChild(newQuestionBtn);

                // Clear options container
                document.getElementById('optionsContainer').innerHTML = '';
                // Add initial options
                addOption();
            }

            // Add initial options
            document.getElementById('addOptionBtn').addEventListener('click', addOption);

            // Add question and reset form on button click
            document.getElementById('addQuestionBtn').addEventListener('click', addQuestion);

            // Function to handle form submission
            function submitForm() {
                const form = document.getElementById('quizForm');
                const formData = new FormData(form);

                // Display form data (you can modify this part based on your backend logic)
                for (const pair of formData.entries()) {
                    console.log(pair[0] + ': ' + pair[1]);
                }
            }

            // Add question and reset form on button click
            document.getElementById('saveQuestionBtn').addEventListener('click', function () {
                submitForm();
                // Reset form after submission
                document.getElementById('quizForm').reset();
                optionIndex = 2; // Reset option index for the next question
                addQuestion(); // Add a new question button
            });

            // Add initial question button
            addQuestion();

            // Add event listener for "Mark as Correct" button
            document.addEventListener('click', function (event) {
                if (event.target.classList.contains('mark-as-correct-btn')) {
                    // Get the parent option container
                    const optionContainer = event.target.closest('.option-container');

                    // Remove 'correct' class from all options
                    const allOptions = document.querySelectorAll('.option-container');
                    allOptions.forEach(opt => {
                        opt.classList.remove('correct-option');
                        
                    // const tickIcon = opt.querySelector('.correct-icon');
                    //     if (tickIcon) {
                    //         opt.removeChild(tickIcon);
                    //     }
                    });

                    // Add 'correct' class to the selected option container
                    optionContainer.classList.add('correct-option');

                    // const tickIcon = document.createElement('span');
                    // tickIcon.className = 'correct-icon fas fa-check';
                    // optionContainer.appendChild(tickIcon);
                }
            });
        });
    </script>

{% endblock content %}

{% endblock
