{% extends 'main_app/base.html' %}
{% load static %}
{% block page_title %}{{ page_title }}{% endblock page_title %}
{% block content %}
<section class="content">
    <div class="container-fluid">
        <!-- Small boxes (Stat box) -->
        <div class="row">
            <div class="col-lg-3 col-6">
                <!-- small box -->
                <div class="small-box bg-info">
                    <div class="inner">
                        <h3>{{ count }}</h3>
                        <p>Total Students</p>
                    </div>
                    <div class="icon">
                        <i class="ion ion-bag"></i>
                    </div>
                </div>
            </div>
            <!-- ./col -->
            <div class="col-lg-3 col-6">
                <!-- small box -->
                <div class="small-box bg-danger">
                    <div class="inner">
                        <h3>{{ num_courses }}</h3>
                        <p>Total Subjects</p>
                    </div>
                    <div class="icon">
                        <i class="ion ion-pie-graph"></i>
                    </div>
                </div>
            </div>
            <!-- ./col -->
        </div>
        <!-- /.row -->
        <!-- Main row -->
        <div class="row">
            <div class="col-md-6">
                <!-- LINE CHART -->
                <div class="card card-secondary">
                  <div class="card-header">
                    <h3 class="card-title">{{ page_title }}</h3>
                    <div class="card-tools">
                      <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i></button>
                      <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-times"></i></button>
                    </div>
                  </div>
                  <div class="card-body">
                    <canvas id="pieChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                  </div>
                </div>
                <!-- /.card-body -->
            </div>
            <div class="col-md-6">
                <div class="card card-secondary">
                  <div class="card-header">
                    <h3 class="card-title">{{ page_title }}</h3>
                    <div class="card-tools">
                      <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i></button>
                      <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-times"></i></button>
                    </div>
                  </div>
                  <div class="card-body">
                    <canvas id="barChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                  </div>
                </div>
            </div>
            <div class="col-md-6">
              <div class="card card-secondary">
                <div class="card-header">
                  <h3 class="card-title">{{ page_title }}</h3>
                  <div class="card-tools">
                    <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i></button>
                    <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-times"></i></button>
                  </div>
                </div>
                <div class="card-body">
                  <canvas id="barChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                </div>
              </div>
          </div>
            <!-- right col -->
        </div>
        <!-- /.row (main row) -->
    </div><!-- /.container-fluid -->
</section>
{% endblock content %}

{% block custom_js %}
<script src="{% static 'assets/js/chart/Chart.js' %}"></script>
<script>
  $(document).ready(function(){
      // Data for the pie chart (total students)
      var totalStudentsData = {
          labels: ['Enrolled Students', 'Total Students'],
          datasets: [
              {
                  data: [{{ count }}, {{ total_students }} - {{ count }}], // Assuming total_students is available in your context
                  backgroundColor: ['#00a65a', '#f39c12'],
              }
          ]
      };
      
      // Data for the bar chart (total courses)
      var totalCoursesData = {
          labels: ['Total Courses'],
          datasets: [
              {
                  label: 'Total Courses',
                  data: [{{ num_courses }}], // Assuming num_courses is available in your context
                  backgroundColor: '#6c757d',
                  borderColor: 'rgba(60,141,188,0.8)',
                  pointRadius: false,
                  pointColor: '#3b8bba',
                  pointStrokeColor: 'rgba(60,141,188,1)',
                  pointHighlightFill: '#fff',
                  pointHighlightStroke: 'rgba(60,141,188,1)',
              }
          ]
      };
      
      // Render the pie chart (total students)
      var pieChartCanvas = $('#pieChart').get(0).getContext('2d');
      var pieChart = new Chart(pieChartCanvas, {
          type: 'pie',
          data: totalStudentsData,
          options: {
              maintainAspectRatio: false,
              responsive: true,
          }
      });
      
      // Render the bar chart (total courses)
      var barChartCanvas = $('#barChart').get(0).getContext('2d');
      var barChart = new Chart(barChartCanvas, {
          type: 'bar',
          data: totalCoursesData,
          options: {
              maintainAspectRatio: false,
              responsive: true,
          }
      });
  });
</script>
<script>
  $(document).ready(function(){
      // Data for the bar chart (courses and number of enrolled students)
      var courseLabels = {{ course_labels|safe|escape }}; // Assuming course_labels is available in your context
      var enrolledStudentsData = {{ enrolled_students_data|safe|escape }}; // Assuming enrolled_students_data is available in your context

      var barChartData = {
          labels: courseLabels,
          datasets: [
              {
                  label: 'Number of Enrolled Students',
                  data: enrolledStudentsData,
                  backgroundColor: '#6c757d',
                  borderColor: 'rgba(60,141,188,0.8)',
                  borderWidth: 1
              }
          ]
      };

      var barChartCanvas = $('#barChart').get(0).getContext('2d');
      var barChart = new Chart(barChartCanvas, {
          type: 'bar',
          data: barChartData,
          options: {
              maintainAspectRatio: false,
              responsive: true,
              scales: {
                  x: {
                      title: {
                          display: true,
                          text: 'Courses'
                      }
                  },
                  y: {
                      beginAtZero: true,
                      title: {
                          display: true,
                          text: 'Number of Students'
                      }
                  }
              },
              plugins: {
                  tooltip: {
                      callbacks: {
                          label: function(context) {
                              var label = context.dataset.label || '';
                              if (label) {
                                  label += ': ';
                              }
                              if (context.parsed.y !== null) {
                                  label += context.parsed.y + ' students';
                              }
                              return label;
                          },
                          title: function(context) {
                              var title = context[0].label || '';
                              return title;
                          }
                      }
                  }
              }
          }
      });
  });
</script>


{% endblock custom_js %}
